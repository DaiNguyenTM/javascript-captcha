{"version":3,"file":"js-captcha-integration-core.js","names":["_helpers","_interopRequireDefault","require","_resourceStrings","_bdClientsideNotExistingException","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","Number","defaultSettings","captchaFormId","languageTag","captchaEndpointUrl","defaultIntegrationType","JsCaptchaIntegrationCore","settings","mergedSettings","helpers","object","mergeObjects","_settings","sanitizeSettings","get","_integrationType","set","type","value","getCaptchaData","getBdClientSideInstance","reloadCaptcha","getHtml","successCallback","errorCallback","userSpecifiedLanguageTag","self","url","createUrl","c","l","ji","_","time","currentTimestamp","ajax","captchaHtml","changeRelativeToAbsoluteUrls","loadScriptInclude","resourceStrings","captcha_error","exports","sanitized","sanitizer","sanitize","jsc","window","botdetect","BdClientSideNotExistingException","getInstanceByCaptchaFormId","scriptId","includedScript","document","getElementById","parentNode","removeChild","captchaId","scriptIncludeUrl","t","cs","integrationType","scriptIncludeElement","dom","createScriptElement","body","appendChild","createJsCaptchaIntegrationCoreInstance","getJsCaptchaIntegrationCoreReleaseNo","releaseNo"],"sources":["../../../src_temp/cjs_build_src/es6/js-captcha-integration-core.js"],"sourcesContent":["/*\r\nCopyright Captcha, Inc. 2004-2023. All rights reserved.\r\n\r\nBotDetect, BotDetect CAPTCHA, Lanap, Lanap CAPTCHA, Lanap BotDetect, \r\nLanap BotDetect CAPTCHA, Lanapsoft, Lanapsoft CAPTCHA, \r\nLanapsoft BotDetect, Lanapsoft BotDetect CAPTCHA, and Lanap Software \r\nare trademarks of Captcha, Inc. All other product, brand, and company \r\nnames are mentioned for identification purposes only and are trademarks \r\nor registered trademarks of their respective owners.\r\n\r\nCaptcha, Inc. - formerly: Lanapsoft, Inc. / Lanap, Inc.\r\n*/\r\n\r\n// BotDetect CAPTCHA JavaScript Integration Core -- ES6\r\n\r\nimport helpers from './helpers';\r\nimport resourceStrings from './resource-strings';\r\nimport BdClientSideNotExistingException from './exceptions/bd-clientside-not-existing-exception';\r\n\r\nconst defaultSettings = {\r\n  captchaFormId: '', // form identifier that has to match one of the <captchaForm><id> values in the bdc-config.xml\r\n  languageTag: '', // language tag\r\n  captchaEndpointUrl: '' // captcha endpoint url on your app's backend\r\n};\r\n\r\nconst defaultIntegrationType = '0'; // unknown integration type\r\n\r\nclass JsCaptchaIntegrationCore {\r\n\r\n  static get releaseNo() {\r\n    return '4.5.0';\r\n  }\r\n\r\n  constructor(settings) {\r\n    const mergedSettings = helpers.object.mergeObjects(defaultSettings, settings);\r\n    this._settings = sanitizeSettings(mergedSettings);\r\n  }\r\n\r\n  get settings() {\r\n    return this._settings;\r\n  }\r\n\r\n  get captchaEndpointUrl() {\r\n    return this.settings.captchaEndpointUrl;\r\n  }\r\n\r\n  get captchaFormId() {\r\n    return this.settings.captchaFormId;\r\n  }\r\n\r\n  get languageTag() {\r\n    return this.settings.languageTag;\r\n  }\r\n\r\n  set integrationType(type) {\r\n    this._integrationType = type;\r\n  }\r\n\r\n  get integrationType() {\r\n    return (this._integrationType === void 0) ?\r\n              defaultIntegrationType\r\n              : this._integrationType;\r\n  }\r\n\r\n  getCaptchaData() {\r\n    return getBdClientSideInstance(this).getCaptchaData();\r\n  }\r\n\r\n  reloadCaptcha() {\r\n    getBdClientSideInstance(this).reloadCaptcha();\r\n  }\r\n\r\n  getHtml(successCallback, errorCallback) {\r\n    const userSpecifiedLanguageTag = this.languageTag;\r\n\r\n    const self = this;\r\n    const url = helpers.url.createUrl(this.captchaEndpointUrl, {\r\n      get: 'html',\r\n      c: this.captchaFormId,\r\n      l: userSpecifiedLanguageTag,\r\n      ji: false, // disable script include\r\n      _: helpers.time.currentTimestamp()\r\n    });\r\n\r\n    helpers.ajax.get(url, \r\n      function(captchaHtml) {\r\n        captchaHtml = helpers.url.changeRelativeToAbsoluteUrls(captchaHtml, self.captchaEndpointUrl);\r\n        successCallback(captchaHtml);\r\n        loadScriptInclude(self, userSpecifiedLanguageTag);\r\n      },\r\n      function() {\r\n        if (typeof errorCallback === 'function') {\r\n          errorCallback(resourceStrings.captcha_error);\r\n        }\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\n// private functions\r\n\r\nfunction sanitizeSettings(settings) {\r\n  let sanitized = {};\r\n  for (let key in settings) {\r\n    const value = settings[key];\r\n    sanitized[key] = helpers.sanitizer.sanitize(value);\r\n  }\r\n  return sanitized;\r\n}\r\n\r\nfunction getBdClientSideInstance(jsc) {\r\n  if (window.botdetect === void 0) {\r\n    throw new BdClientSideNotExistingException();\r\n  }\r\n\r\n  return window.botdetect.getInstanceByCaptchaFormId(jsc.captchaFormId);\r\n}\r\n\r\nfunction loadScriptInclude(jsc, userSpecifiedLanguageTag) {\r\n  // remove included script if it exists\r\n  const scriptId = 'script_include_' + jsc.captchaFormId;\r\n  const includedScript = document.getElementById(scriptId);\r\n  if (includedScript) {\r\n    includedScript.parentNode.removeChild(includedScript);\r\n  }\r\n\r\n  // include new script to body\r\n  const captchaId = document.getElementById('BDC_VCID_' + jsc.captchaFormId).value;\r\n  const scriptIncludeUrl = helpers.url.createUrl(jsc.captchaEndpointUrl, {\r\n    get: 'script-include',\r\n    c: jsc.captchaFormId,\r\n    l: userSpecifiedLanguageTag,\r\n    t: captchaId,\r\n    cs: jsc.integrationType\r\n  });\r\n  const scriptIncludeElement = helpers.dom.createScriptElement(scriptId, scriptIncludeUrl);\r\n  document.body.appendChild(scriptIncludeElement);\r\n}\r\n\r\nfunction createJsCaptchaIntegrationCoreInstance(settings) {\r\n  return new JsCaptchaIntegrationCore(settings);\r\n}\r\n\r\nfunction getJsCaptchaIntegrationCoreReleaseNo() {\r\n  return JsCaptchaIntegrationCore.releaseNo;\r\n}\r\n\r\n(function(window) {\r\n  window.JsCaptchaIntegrationCore = JsCaptchaIntegrationCore;\r\n  window.createJsCaptchaIntegrationCoreInstance = createJsCaptchaIntegrationCoreInstance;\r\n  window.getJsCaptchaIntegrationCoreReleaseNo = getJsCaptchaIntegrationCoreReleaseNo;\r\n})(window);\r\n\r\nexport { \r\n  JsCaptchaIntegrationCore, \r\n  createJsCaptchaIntegrationCoreInstance,\r\n  getJsCaptchaIntegrationCoreReleaseNo\r\n};\r\n"],"mappings":"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"}